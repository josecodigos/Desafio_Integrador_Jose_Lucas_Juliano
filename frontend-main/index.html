<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
</head>

<body>
    <form id="myForm" name="myForm">
        <fieldset>
            <legend>Pessoa</legend>

            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome"> <br><br>

            <label for="curso">Curso:</label>
            <input type="curso" id="curso" name="curso"> <br><br>

            <label for="periodo">Período:</label>
            <input type="periodo" id="periodo" name="periodo"> <br><br>

            <input id="postSubmit" type="submit" value="Salvar">

        </fieldset>
    </form>

    <table data-js = "idTabela">
        <tr>
            <th>Nome:</th>
            <th>Curso:</th>
            <th>Período:</th>
        </tr>
    </table>

    <script>
        const thisForm = document.getElementById('myForm');
        thisForm.addEventListener('submit', async function (e) {
            e.preventDefault();
            const formData = new FormData(thisForm).entries()
            const response = await fetch('http://localhost:5000/alunos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(Object.fromEntries(formData))
            });

            const result = await response.json();
            console.log(result)
            carregarLista()
        });

        const carregarLista = () => {
            fetch('http://localhost:5000/alunos')
            .then(data =>  data.json())
            .then(data => {
                console.log(data)
                const html = data.pessoa.reduce((acumulador, item) => {
                    acumulador +=`<tr> <td>${item.nome}</td> <td>${item.curso}</td> <td>${item.periodo}</td> </tr>`
                    return acumulador
                }, '')
                const table = document.querySelector('[data-js = "idTabela"]')
                table.innerHTML = html
            })
            .catch(err => console.log(err))
        }
        carregarLista()
    </script>
</body>

</html>